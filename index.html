<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Wash Quality Control Checklist</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Previous styles remain the same */
        .score-details {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }
        .percentage {
            font-weight: bold;
            color: #007bff;
        }
        .score-breakdown {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- Previous HTML structure remains the same -->
    <script>
        // Updated items array with weights
        const items = [
            { id: 1, name: 'Visual Inspection', weight: 0.9, score: 0, notes: '', image: null },
            { id: 2, name: 'Dimensions Check', weight: 0.5, score: 0, notes: '', image: null },
            { id: 3, name: 'Functionality Test', weight: 0.7, score: 0, notes: '', image: null }
        ];

        function calculateItemPercentage(item) {
            const maxPossible = item.weight * 5;
            const actual = item.weight * item.score;
            return (actual / maxPossible) * 100;
        }

        function calculateTotalScore() {
            let totalPercentage = 0;
            items.forEach(item => {
                totalPercentage += calculateItemPercentage(item);
            });
            return totalPercentage / items.length;
        }

        function createChecklistItem(item) {
            const div = document.createElement('div');
            div.className = 'checklist-item';
            const percentage = calculateItemPercentage(item);
            
            div.innerHTML = `
                <div class="item-header">
                    <h3>${item.name} (Weight: ${item.weight})</h3>
                    <div class="item-controls">
                        <select onchange="updateScore(${item.id}, this.value)">
                            <option value="0" ${item.score === 0 ? 'selected' : ''}>Select Score</option>
                            <option value="1" ${item.score === 1 ? 'selected' : ''}>1 - Poor</option>
                            <option value="2" ${item.score === 2 ? 'selected' : ''}>2 - Fair</option>
                            <option value="3" ${item.score === 3 ? 'selected' : ''}>3 - Good</option>
                            <option value="4" ${item.score === 4 ? 'selected' : ''}>4 - Very Good</option>
                            <option value="5" ${item.score === 5 ? 'selected' : ''}>5 - Excellent</option>
                        </select>
                        <input type="file" 
                               id="image-${item.id}" 
                               accept="image/*" 
                               style="display: none"
                               onchange="handleImageUpload(${item.id}, this)">
                        <button class="button" onclick="document.getElementById('image-${item.id}').click()">
                            ðŸ“· Upload Photo
                        </button>
                    </div>
                </div>
                <div class="score-details">
                    Raw Score: ${item.score}/5 | Weight: ${item.weight} | 
                    <span class="percentage">Running at ${percentage.toFixed(1)}% of perfect</span>
                </div>
                <textarea
                    placeholder="Add notes here..."
                    onchange="updateNotes(${item.id}, this.value)"
                >${item.notes}</textarea>
                <div id="preview-${item.id}">
                    ${item.image ? `<img src="${item.image}" class="photo-preview">` : ''}
                </div>
            `;
            return div;
        }

        function updateTotalScore() {
            const totalScore = calculateTotalScore();
            document.getElementById('total-score').innerHTML = 
                `Total Score: ${totalScore.toFixed(1)}% of Perfect Operation`;
        }

        function generatePDF() {
            if (!selectedLocation) {
                alert('Please select a location first');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.text('Quality Control Report', 20, 20);
            doc.setFontSize(16);
            doc.text(`Location: ${selectedLocation}`, 20, 30);
            doc.setFontSize(12);
            
            let yPos = 45;
            const totalScore = calculateTotalScore();
            
            doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, yPos);
            yPos += 10;
            doc.text(`Overall Performance: ${totalScore.toFixed(1)}% of Perfect Operation`, 20, yPos);
            yPos += 20;

            items.forEach((item, index) => {
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }

                const percentage = calculateItemPercentage(item);

                doc.setFontSize(14);
                doc.text(`${item.name}`, 20, yPos);
                yPos += 10;
                
                doc.setFontSize(12);
                doc.text(`Score: ${item.score}/5 | Weight: ${item.weight}`, 30, yPos);
                yPos += 10;
                doc.text(`Running at ${percentage.toFixed(1)}% of perfect`, 30, yPos);
                yPos += 10;
                
                if (item.notes) {
                    doc.text('Notes:', 30, yPos);
                    yPos += 10;
                    const splitNotes = doc.splitTextToSize(item.notes, 150);
                    doc.text(splitNotes, 40, yPos);
                    yPos += splitNotes.length * 7;
                }

                if (item.image) {
                    try {
                        doc.addImage(item.image, 'JPEG', 30, yPos, 100, 60);
                        yPos += 70;
                    } catch (e) {
                        console.error('Error adding image to PDF:', e);
                    }
                }

                yPos += 10;
            });

            doc.save(`QC_Report_${selectedLocation}_${new Date().toISOString().split('T')[0]}.pdf`);
        }

        // Rest of the previous functions remain the same
    </script>
</body>
</html>
