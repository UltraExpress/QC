<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* CSS styles remain the same */
    </style>
</head>
<body>
    <div class="header">
        <h2>Quality Control Checklist RIVERSIDE</h2>
        <button class="reset-btn" onclick="resetForm()">Reset All Items</button>
    </div>

    <div class="inspector-section">
        <input 
            type="text" 
            id="inspector-name" 
            placeholder="Inspector Name" 
            class="inspector-input"
        >
    </div>

    <div id="total-score" class="total-score">Total Score: 0</div>
    
    <div id="checklist-container">
        <div class="loading">Loading checklist items...</div>
    </div>

    <button id="pdfButton" class="pdf-button" onclick="generatePDF()" disabled>
        Make a PDF Report
    </button>

    <script>
        let checklistItems = [];
        let inspectorName = '';

        document.getElementById('inspector-name').addEventListener('input', function(e) {
            inspectorName = e.target.value.trim();
            localStorage.setItem('inspectorName', inspectorName);
            
            // Get all interactive elements
            const ratingButtons = document.querySelectorAll('.rating-btn');
            const noteInputs = document.querySelectorAll('.notes');
            const fileInputs = document.querySelectorAll('input[type="file"]');
            const pdfButton = document.getElementById('pdfButton');
            
            // Enable/disable based on inspector name
            if (inspectorName) {
                ratingButtons.forEach(btn => {
                    btn.disabled = false;
                    btn.style.cursor = 'pointer';
                });
                noteInputs.forEach(input => {
                    input.disabled = false;
                    input.style.cursor = 'text';
                });
                fileInputs.forEach(input => {
                    input.disabled = false;
                    input.style.cursor = 'pointer';
                });
                if (allItemsComplete()) {
                    pdfButton.disabled = false;
                    pdfButton.classList.add('ready');
                }
            } else {
                ratingButtons.forEach(btn => {
                    btn.disabled = true;
                    btn.style.cursor = 'not-allowed';
                });
                noteInputs.forEach(input => {
                    input.disabled = true;
                    input.style.cursor = 'not-allowed';
                });
                fileInputs.forEach(input => {
                    input.disabled = true;
                    input.style.cursor = 'not-allowed';
                });
                pdfButton.disabled = true;
                pdfButton.classList.remove('ready');
            }

            // Force a re-render to ensure all elements are properly disabled/enabled
            renderChecklist();
        });

        async function loadChecklist() {
            try {
                const response = await fetch('https://ultraexpress.github.io/QC/riverside-checklist.json');
                if (!response.ok) throw new Error('Failed to load checklist data');
                
                const data = await response.json();
                checklistItems = data.items.map(item => ({
                    ...item,
                    score: 0,
                    notes: "",
                    image: null
                }));
                
                const storedItems = localStorage.getItem('checklistItems');
                if (storedItems) {
                    checklistItems = JSON.parse(storedItems);
                }
                renderChecklist();

                const storedName = localStorage.getItem('inspectorName');
                if (storedName) {
                    inspectorName = storedName;
                    document.getElementById('inspector-name').value = inspectorName;
                }
            } catch (error) {
                document.getElementById('checklist-container').innerHTML = `
                    <div class="error">
                        Error loading checklist: ${error.message}
                        <br>Please refresh the page to try again.
                    </div>
                `;
            }
        }

        function renderChecklist() {
            // Rendering code remains the same
        }

        function getRatingDescription(rating) {
            // Rating descriptions remain the same
        }

        function checkComplete(index) {
            // Check complete function remains the same
        }

        function checkAllItemsComplete() {
            // Check all items complete function remains the same
        }

        function setRating(index, rating) {
            // Set rating code remains the same
            localStorage.setItem('checklistItems', JSON.stringify(checklistItems));
        }

        function updateNotes(index, notes) {
            // Update notes code remains the same
            localStorage.setItem('checklistItems', JSON.stringify(checklistItems));
        }

        function handleImageUpload(index, event) {
            // Handle image upload code remains the same
            reader.onload = function(e) {
                // Rest of the code remains the same
                localStorage.setItem('checklistItems', JSON.stringify(checklistItems));
            }
        }

        function updateTotalScore() {
            // Update total score function remains the same
        }

        function resetForm() {
            if (confirm('Are you sure you want to reset all items? This will clear all ratings, notes, and images.')) {
                checklistItems.forEach(item => {
                    item.score = 0;
                    item.notes = '';
                    item.image = null;
                });
                renderChecklist();
                updateTotalScore();
                checkAllItemsComplete();
                localStorage.removeItem('checklistItems');
                localStorage.removeItem('inspectorName');
            }
        }

        async function generatePDF() {
            // PDF generation code remains the same
        }

        // Load the checklist when the page loads
        loadChecklist();
    </script>
</body>
</html>
